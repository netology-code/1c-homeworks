# Планы видов расчета и регистры расчета

## Задание 1

### Описание задачи

Создать простой план видов расчета и регистр для расчета управленческой зарплаты.

### Требование к результату

Конфигурация из [диплома Б](diploma-b.md), содержащая план видов расчета "НачисленияИУдержания" с предопределенными видами расчета "Оплата по окладу", "Оплата по ставке часа", "Премия", "Отпуск", "Больничный" и регистр расчета "Зарплата" с единственным измерением "Сотрудник" и ресурсом "Сумма".

### Процесс выполнения

Используйте конфигурацию из предыдущих заданий.

1. Добавьте подсистему **Зарплата**.

2. Добавьте в нее план видов расчета **НачисленияУдержания**, использующий период действия.
К нему добавьте предопределенные виды расчетов:

* ОплатаПоОкладу ("Оплата по окладу")
* ОплатаПоСтавкеЧаса ("Оплата по ставке часа")
* Премия ("Премия")
* Отпуск ("Отпуск")
* Больничный ("Больничный")

3. Добавьте в нее регистр расчетов **Зарплата** с периодичностью "Месяц", использующий период действия и базовый период.
К нему добавьте измерение **Сотрудник** (СправочникСсылка.Сотрудники) и ресурс **Сумма** (ОпределяемыйТип.Сумма).

4. Включите добавленные объекты в состав функциональной опции **ВестиРасчетЗарплаты**.

## Задание 2

### Описание задачи

Создать документ "Начисление по окладу", позволяющий ввести начисление по окладу по списку сотрудников с учетом графика работы и вытеснения.

### Требование к результату

Конфигурация из предыдущего задания, содержащая документ **НачислениеПоОкладу**, позволяющий указать таблицу сотрудников.
Документ должен рассчитывать оклад, умножая реквизит **Оклад** справочника  **Сотрудники** на отношение фактически отработанного времени к норме.
Норма должна рассчитываться согласно графику по периоду действия. Факт - согласно графику по фактическому периоду (т.е. с учетом вытеснения).

### Процесс выполнения

Конфигурация из предыдущего задания.

1. Добавьте непериодический регистр сведений **Календарь**.

Добавьте измерение **Дата** (Дата) и ресурс **РабочийДень** (Число). Ресурс будет содержать 1, если день рабочий, и 0 в противном случае.
Укажите его в качестве графика регистра расчета **Зарплата**.
Включите его в состав функциональной опции **ВестиРасчетЗарплаты**.

2. Добавьте документ **НачислениеПоОкладу**.

Добавьте к нему табличную часть **Сотрудники** с реквизитом **Сотрудник**.
Сделайте его регистратором регистра расчета **Зарплата**.
Включите его в состав функциональной опции **ВестиРасчетЗарплаты**.
Выведите реквизиты на форму разумным образом.

3. В модуле документа создайте обработку проведения документа, в которой:

* Соберите запросом оклады сотрудников из документа по данным справочника **Сотрудники**.
* Очистите набор записей Движения.Зарплата.
* Для каждой строки табличной части создайте движение, заполнив в нем вид расчета (**ПланыВидовРасчета.НачисленияУдержания.ОплатаПоОкладу***), сотрудника, период регистрации и период действия. Период действия берите как начало и конец месяца даты документа. Сумму на этом этапе не заполняйте.
* Запишите набор записей Движения.Зарплата.
* Для каждой записи:
* * Вызовом функции **РегистрыРасчета.Зарплата.ПолучитьДанныеГрафика** получите число рабочих дней в периоде действия (норму) и число рабочих дней в фактическом периоде (факт).
* * Установите сумму как Оклад * Факт /  Норма.
* Снова запишите набор записей Движения.Зарплата.

4. Заполните и проведите документ. Удостоверьтесь в том, что движения по регистру формируются по окладу в отсутствие вытесняющих оклад начислений (больничного, отпуска), и уменьшаются согласно дням неявки.
