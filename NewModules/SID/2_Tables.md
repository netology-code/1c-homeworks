# Задание к занятию «Табличные части»

## Цель задания

1. Освоить работу с табличными частями в 1С.
2. Подготовить конфигурацию к последующей работе.

## Чеклист готовности к домашнему заданию

- [ ] Установить учебную платформу версии 8.3.22 или больше.
- [ ] Подготовить разработанную ранее конфигурацию "УправлениеИТФирмой"
- [ ] Просмотреть материал занятия «Табличные части».

## Инструкция к заданию

1. Решите описанные задачи в конфигураторе.

В тексте задания приведен программный код для решения задач. Конечно, Вы можете использовать его. Но для более продуктивного обучения, старайтесь, сначала, самостоятельно написать код. Если все же, самостоятельно решить задачу не удалось, используйте код из текста задачи но обязательно пройдите его в отладке, посмотрите, что попадает в переменные, как преобразуются значения. Старайтесь максимально детально разобраться в механизме.

2. Протестируйте решение в пользовательском режиме, обязательно введите данные в базу, убедитесь, что все работает.
3. Отправьте на проверку в личном кабинете Нетологии один общий файл базы данных (.dt), содержащей решение всех задач.

## Задача 1. Документы «Поступление товаров и услуг» и «Реализация товаров и услуг»

### Описание задачи

Учётные системы, как правило, содержат документы, регистрирующие факты закупки и продажи товаров и услуг. Задача — создать документы «Поступление товаров и услуг» и «Реализация товаров и услуг», отражающие закупку и продажу товаров и услуг, но пока не формирующие движения по остаткам и взаиморасчётам.

Документ должен содержать следующие данные:

- стандартные «Номер» (Строка) и «Дата» (Устанавливается при записи документа);
- «Контрагент» (СправочникСсылка.Контрагенты);
- «Ответственный» (СправочникСсылка.Сотрудники, Заполняется значением текущего сотрудника, связанного с пользователем, из параметра сеанса);
- «СуммаДокумента» (Число. Перед записью объекта заполняется итогом по колонке «Сумма» табличной части «Товары»);
- «Комментарий» (Строка неограниченной длины. Поле ввода — многострочное);
- Табличная часть «Товары» с реквизитами:

  - «Номенклатура» (СправочникСсылка.Номенклатура);
  - «Количество» (Число, или определяемый тип, содержащий число);
  - «Цена» (Определяемый тип, описывающий денежные значения);
  - «Сумма» (Определяемый тип, описывающий денежные значения).

Документы должны иметь свои формы объекта, выбора, списка.

Все реквизиты должны присутствовать на форме и быть доступными для редактирования. Все реквизиты обязательны для заполнения кроме реквизита «СуммаДокумента» и «Комментарий».

Документы необходимо выводить в одном общем списке "ДвиженияТовара" Список должен дополнительно отображать информацию о Контрагенте и общей сумме по документу.

### Процесс выполнения

1. Создайте новый документ "ПоступлениеТоваровИУслуг", определите его реквизиты и табличную часть.
2. Укажите для документа подсистему - Сделки
3. Настройте реквизиты документа, как это требуется по заданию.
4. В модуле объекта документа добавить обработчик события «ПередЗаписью», в коде которого заполнить реквизит «СуммаДокумента» итогом по колонке «Сумма» табличной части «Товары»

<details>
  <summary>Код</summary>
  
```bsl
СуммаДокумента = Товары.Итог("Сумма");
```

</details>

5. Создайте формы документа, списка и выбора. На формы выведите необходимые для работы с ними реквизиты.
6. На форме документа добавьте расчёт «Суммы» в строке табличной части. При изменении «Количества» или «Цены» значение в колонке «Сумма» должно пересчитываться перемножением «Количества» на «Цену».

<details>
  <summary>Код</summary>
  
```bsl
&НаКлиенте
Процедура ТоварыКоличествоПриИзменении(Элемент)

	РассчитатьСуммуСтроки();

КонецПроцедуры

&НаКлиенте
Процедура ТоварыЦенаПриИзменении(Элемент)

	РассчитатьСуммуСтроки();

КонецПроцедуры

&НаКлиенте
Процедура РассчитатьСуммуСтроки()

	ТекущиеДанные = Элементы.Товары.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;

	ТекущиеДанные.Сумма = ТекущиеДанные.Количество * ТекущиеДанные.Цена;

КонецПроцедуры
```
  
</details>

5. Повторить всё для документа «Реализация товаров и услуг». (или скопируйте документ Поступление товаров и услуг, изменив только то, что отличает один документ от другого)
6. Создайте Журнал документов «Движения товаров», укажите для него подсистему "Сделки", выведите в него оба документа. В качестве дополнительных граф выведите «Контрагент» и «СуммаДокумента».

<details>
  <summary>Дополнительно</summary>
  
  Настройте командный интерфейс подсистемы "Сделки" так, чтобы с ним было удобно работать пользователю.
  
  Например, наверняка пользователь будет работать через журнал, но совсем убирать списки документов из интерфейса не правильно - можно расположить их в разделе "См. также"
  
</details>

## Задача 2. Работа с табличной частью

### Описание задачи

Добавить в документы из задачи 1 сортировку строк по сумме, а также расчёт общего итога по колонке «Сумма».
Требуется реализовать отдельную команду, которая выполняла бы сортировку по сумме табличной части.

### Процесс выполнения

В форме обоих документов:

1. Добавить вывод подвала в табличной части
2. Для колонки Сумма заполнить свойство "Путь к данным подвала", можно так же, заполнить "Текст подвала"

<details>
  <summary>ПутьКДаннымПодвала</summary>
  Объект.Товары.ИтогСумма  
</details>

3. Добавьте команду "СортироватьПоСумме". Назначьте ей картинку.
4. Вынесите команду в командную панель табличной части. Настройте свойство кнопки Отображение тем способом, который покажется Вам наиболее корректным.
5. Пропишите программный код для сортировки таблицы

## Задача 3*. Сортировка в разных направлениях

*Это дополнительная задача, реализовывать ее не обязательно.*
*Задача предназначена для тех студентов, которым первые покажутся слишком простыми.*
*В процессе выполнения не будут даны примеры программного кода.*

### Описание задачи

Реализуйте следующий сценарий поведения:

При первом нажатии на кнопку сортировки выполняется сортировка по возрастанию, при повторном нажатии - по убыванию. При каждом нажатии направление сортировки должно меняться.

### Процесс выполнения

1. Добавьте в форму реквизит СортироватьПоВозрастанию с типом Булево. Данный реквизит будет хранить текущее направление сортировки, на форму его выводить не нужно.
2. При каждом нажатии на кнопку, меняйте значение данного реквизита.
3. В зависимости от значения реквизита, сортируйте таблицу по возрастанию или убыванию.
4. Так же, можно менять заголовок и картинку на кнопке

## Задача 4*. Расчет количества по сумме

*Это дополнительная задача, реализовывать ее не обязательно.*
*Задача предназначена для тех студентов, которым первые покажутся слишком простыми.*
*В процессе выполнения не будут даны примеры программного кода.*

### Описание задачи

Реализуйте более сложные расчеты в таблице для документа Реализация товаров и услуг. Например, к нам приходит покупатель и просит продать ему максимальное количество товара на определенную сумму. Необходимо рассчитать максимальное количество товара на указанную сумму.

### Процесс выполнения

1. Добавьте обработчик изменения суммы.
2. Если цена не установлена - никакие расчеты выполняться не должны.
3. Рассчитайте максимальное целое количество товара, которое можно продать по указанной цене.
4. Рассчитайте актуальную сумму.

## Пример

[Пример выполнения домашнего задания](examples/HW_4_2_example.md)

## Критерии оценки

Зачёт ставится, если:

1. Программа запускается, не возникает явных ошибок, исключений при выполнении программы (в том числе, если Вы начали делать дополнительную задачу, ее функционал не должен приводить к ошибкам и исключениям)
2. Созданы необходимые документы и журнал документов
3. Типы данных для реквизитов установлены корректно
4. Все объекты отображаются в интерфейсе
5. Корректно работает расчет в таблицах обоих документов, реализована сортировка, подсчет суммы по документу
6. В журнале документов выводятся необходимые графы
7. Введены тестовые данные

Задачи 1 и 2 обязательны к выполнению (кроме текста под спойлером "Дополнительно" - эти задачи делать не обязательно. Возможно, Вы вернетесь к ним позднее, после того, как изучите дополнительный материал). Задачи 3 и 4 - не обязательны.

Пожалуйста, присылайте на проверку все задачи сразу, одним файлом выгрузки информационной базы (dt)

Любые вопросы по решению задач задавайте в чате учебной группы.

